<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/reset.css" />
    <link rel="stylesheet" href="./css/widgets.css" />
    <link
      rel="stylesheet"
      href="./node_modules/element-ui/lib/theme-chalk/index.css"
    />
    <style>
      [v-cloak] {
        display: none;
      }
      .amap-logo {
        right: 0 !important;
        left: auto !important;
        display: none !important;
      }
      .amap-copyright {
        right: 70px !important;
        left: auto !important;
        opacity: 0 !important;
      }
      .amap-marker-label {
        border: 1px dashed blue;
      }
      .custom-info {
        border: solid 1px silver;
      }
      .content-window-card {
        position: relative;
        box-shadow: none;
        bottom: 0;
        left: 0;
        width: auto;
        padding: 0;
      }
      div.info-top {
        background-color: #f9f9f9;
        border-bottom: 1px solid #cccccc;
      }
      div.info-top div {
        display: inline-block;
        color: #333333;
        font-size: 14px;
        font-weight: bold;
        line-height: 31px;
        padding: 0 10px;
      }
      div.info-top img {
        position: absolute;
        top: 10px;
        right: 10px;
        transition-duration: 0.25s;
      }

      div.info-top img:hover {
        box-shadow: 0px 0px 5px #000;
      }

      div.info-middle {
        font-size: 12px;
        padding: 10px 6px;
        line-height: 20px;
      }
      div.info-bottom {
        height: 0px;
        width: 100%;
        clear: both;
        text-align: center;
      }

      div.info-bottom img {
        position: relative;
        z-index: 104;
      }
      *::-webkit-scrollbar {
        width: 7px;
        height: 10px;
        background-color: transparent;
      } /*定义滚动条高宽及背景 高宽分别对应横竖滚动条的尺寸*/
      *::-webkit-scrollbar-track {
        background-color: #fff;
      } /*定义滚动条轨道 内阴影+圆角*/
      *::-webkit-scrollbar-thumb {
        background-color: #00b1df;
        border-radius: 6px;
      } /*定义滑块 内阴影+圆角*/
      .scrollbarHide::-webkit-scrollbar {
        display: none;
      }
      .scrollbarShow::-webkit-scrollbar {
        display: block;
      }
      .button:hover img {
        /* border: 1px solid #cbcbcb; */
        background: #00b1df;
        filter: alpha(Opacity=50);
        -moz-opacity: 0.5;
        opacity: 0.5;
      }
      .el-tree {
        background-color: transparent;
      }
      .gaojin {
        background-color: transparent;
      }
      .header-top {
        position: relative;
      }
      .btn-right {
        position: absolute;
        /* top: 5px; */
        right: 190px;
      }
    </style>
  </head>

  <body>
    <div id="app">
      <div>
        <div
          class="header-top"
          style="
            display: flex;
            background-image: url(./img/background.png);
            height: 60px;
            justify-content: center;
          "
        >
          <p
            style="
              vertical-align: middle;
              font-size: 36px;
              margin-bottom: 0.5%;
              margin-top: 0.2%;
              color: #01c4f7;
              text-align: center;
            "
            v-cloak
          >
            {{titleShow}}
          </p>
          <div class="btn-right">
            <el-button type="text" @click="quit">
              <img src="./img/退出.png" alt="" />
            </el-button>
          </div>
        </div>
        <div class="top">
          <div class="top_left">
            <div style="width: 25%; height: 600px; overflow: auto">
              <div style="margin-left: 28%" class="button">
                <el-button
                  @click="full"
                  size="mini"
                  type="text"
                  title="视频监控"
                  ><img src="./img/监测点对比分析.png" alt="" />
                  <p style="font-size: 10px; color: #fff; margin-top: 8px">
                    视频监控
                  </p>
                </el-button>
              </div>

              <div style="margin-left: 28%" class="button">
                <el-button
                  size="mini"
                  type="text"
                  title="测温装置"
                  @click="temperature"
                  ><img src="./img/测温.png" alt="" />
                  <p style="font-size: 10px; color: #fff; margin-top: 8px">
                    测温装置
                  </p>
                </el-button>
              </div>
              <div style="margin-left: 26%" class="button">
                <el-button
                  size="mini"
                  type="text"
                  title="布控装置"
                  @click="control"
                  ><img src="./img/监控.png" alt="" />
                  <p style="font-size: 10px; color: #fff; margin-top: 8px">
                    布控装置
                  </p>
                </el-button>
              </div>
              <div style="margin-left: 26%" class="button">
                <el-button
                  size="mini"
                  type="text"
                  title="杆塔监测"
                  @click="tower"
                  ><img src="./img/铁塔.png" alt="" />
                  <p style="font-size: 10px; color: #fff; margin-top: 6px">
                    杆塔监测
                  </p>
                </el-button>
              </div>
              <div style="margin-left: 28%" class="button">
                <el-button
                  size="mini"
                  type="text"
                  title="螺丝松动"
                  @click="screw"
                  ><img src="./img/螺丝.png" alt="" />
                  <p style="font-size: 10px; color: #fff; margin-top: 6px">
                    螺丝松动
                  </p>
                </el-button>
              </div>
              <div style="margin-left: 24%" class="button">
                <el-button
                  size="mini"
                  type="text"
                  title="驱鸟系统"
                  @click="bird"
                  ><img src="./img/鸟02.png" alt="" />
                  <p style="font-size: 10px; color: #fff; margin-top: 8px">
                    驱鸟系统
                  </p>
                </el-button>
              </div>
              <div class="button" style="margin-left: 28%">
                <el-button
                  size="mini"
                  type="text"
                  title="GNSS"
                  @click="displacement"
                  ><img src="./img/边坡.png" alt="" />
                  <p style="font-size: 10px; color: #fff; margin-top: 6px">
                    GNSS
                  </p>
                </el-button>
              </div>

              <div style="margin-left: 16%" class="button">
                <el-button
                  size="mini"
                  type="text"
                  title="AI智能分析"
                  @click="ai"
                  ><img src="./img/ai智能分析.png" alt="" />
                  <p style="font-size: 10px; color: #fff; margin-top: 8px">
                    AI智能分析
                  </p>
                </el-button>
              </div>
              <div class="button">
                <el-button
                  size="mini"
                  type="text"
                  title="线路故障定位系统"
                  @click="location"
                  ><img src="./img/故障定位.png" alt="" />
                  <p style="font-size: 10px; color: #fff; margin-top: 8px">
                    线路故障定位系统
                  </p>
                </el-button>
              </div>
              <div style="margin-left: 17%" class="button">
                <el-button
                  size="mini"
                  type="text"
                  title="无人机巡检"
                  @click="uva"
                  ><img src="./img/无人机.png" alt="" />
                  <p style="font-size: 10px; color: #fff; margin-top: 4px">
                    无人机巡检
                  </p>
                </el-button>
              </div>
              <div style="margin-left: 28%" class="button">
                <el-button size="mini" type="text" title="安全帽" @click="safe"
                  ><img src="./img/安全帽.png" alt="" />
                  <p style="font-size: 10px; color: #fff; margin-top: 4px">
                    安全帽
                  </p>
                </el-button>
              </div>
              <div style="margin-left: 27%" class="button">
                <el-button size="mini" type="text" title="日志" @click="journal"
                  ><img src="./img/日志.png" alt="" />
                  <p style="font-size: 10px; color: #fff; margin-top: 4px">
                    日志
                  </p>
                </el-button>
              </div>
            </div>
            <!-- 线路信息树状展示 -->
            <div style="width: 73%; margin-left: 2%; overflow: auto">
              <p style="font-size: 26px; color: #00b1df">线路信息</p>
              <el-tree
                :data="departTreeList"
                :props="defaultProps"
                @node-click="handleNodeClick"
                :default-expand-all="true"
              >
                <span class="custom-tree-node" slot-scope="{node,data}">
                  <span style="color: #00b1df" v-cloak>
                    <i
                      ><img
                        src="./img/部门.png"
                        alt=""
                        v-if='data.node_type == "DEPARTMENT"'
                      />
                      <img
                        src="./img/线路.png"
                        alt=""
                        v-if='data.node_type == "LINE"'
                      />
                      <img
                        src="./img/杆塔.png"
                        alt=""
                        v-if='data.node_type == "TOWER"'
                      />
                      <img
                        src="./img/设备.png"
                        alt=""
                        v-if='data.node_type == "DEVICE"'
                      />
                    </i>
                    {{ data.name }}
                  </span>
                </span>
              </el-tree>
            </div>
          </div>
          <div class="top_center">
            <div id="earth"></div>
          </div>
        </div>
        <div class="middle" style="margin-top: 0.25%">
          <div style="width: 20%"></div>
          <div style="width: 60%">
            <p style="font-size: 22px; color: #00b1df; margin-left: 40%">
              AI告警巡检图
            </p>
          </div>
          <div style="width: 20%">
            <p style="font-size: 22px; color: #00b1df; margin-left: 23%">
              AI告警详情
            </p>
          </div>
        </div>
        <div class="bottom">
          <div class="bottom_left">
            <!-- <p style="font-size: 26px; color: #00b1df; text-align: center">
              设备统计图
            </p> -->
            <div id="echartss"></div>
          </div>
          <div style="width: 80%">
            <div>
              <div
                style="
                  height: 190px;
                  border-bottom: 1px solid #00b1df;
                  border-top: 1px solid #00b1df;
                  display: flex;
                  width: 100%;
                "
              >
                <div style="width: 70%">
                  <el-carousel
                    :interval="8000"
                    type="card"
                    height="190px"
                    indicator-position="none"
                    v-loading="loading"
                    element-loading-text="拼命加载中"
                    element-loading-spinner="el-icon-loading"
                    element-loading-background="rgba(0, 0, 0, 0.8)"
                    v-if="image"
                  >
                    <el-carousel-item v-for="(item,i) in indexlist" :key="i">
                      <div v-for="(items,i) in item.picUrlList" :key="i">
                        <!-- {{items}} -->
                        <img :src="items.picUrl" alt="" @click="open(item)" />
                      </div>
                    </el-carousel-item>
                  </el-carousel>
                  <el-carousel
                    :interval="8000"
                    type="card"
                    height="190px"
                    indicator-position="none"
                    v-loading="loading"
                    element-loading-text="拼命加载中"
                    element-loading-spinner="el-icon-loading"
                    element-loading-background="rgba(0, 0, 0, 0.8)"
                    v-else
                  >
                    <el-carousel-item v-for="(item,i) in indexlist" :key="i">
                      <div v-for="(items,i) in item.pic_url_list" :key="i">
                        <!-- {{items}} -->
                        <img
                          :src="imageurl+items.fileName"
                          alt=""
                          @click="open(item)"
                        />
                      </div>
                    </el-carousel-item>
                  </el-carousel>
                  <!-- <el-dialog :visible.sync="dialogTableVisible" width="70%">
                  <el-image
                    :src="src"
                    alt=""
                    style="width: 95%"
                    :preview-src-list="imagelist"
                  ></el-image>
                </el-dialog> -->
                </div>

                <div
                  style="
                    height: 190px;
                    border-left: 1px solid #00b1df;
                    overflow: auto;
                    width: 30%;
                  "
                >
                  <el-card
                    class="box-card gaojin"
                    v-loading="loading"
                    style="height: 190px"
                    element-loading-text="拼命加载中"
                    element-loading-spinner="el-icon-loading"
                    element-loading-background="rgba(0, 0, 0, 0.8)"
                    v-if="image"
                  >
                    <div v-for="(o,i) in presetName" :key="i">
                      <el-button
                        @click="open(o)"
                        type="text"
                        style="padding: 0"
                        title="点击跳转到改设备"
                      >
                        <div v-cloak>
                          <i
                            class="el-icon-warning-outline"
                            style="color: red"
                          ></i>
                          <span
                            style="
                              width: 130px;
                              display: inline-block;
                              text-align: left;
                            "
                            >{{o.cameraName}}</span
                          >
                          <span
                            style="
                              width: 130px;
                              display: inline-block;
                              text-align: left;
                            "
                            >{{o.violators}}</span
                          >
                          <span
                            style="
                              width: 130px;
                              display: inline-block;
                              text-align: left;
                            "
                            >{{o.createTime}}</span
                          >
                        </div></el-button
                      >
                    </div>
                  </el-card>
                  <el-card
                    class="box-card"
                    v-loading="loading"
                    element-loading-text="拼命加载中"
                    element-loading-spinner="el-icon-loading"
                    element-loading-background="rgba(0, 0, 0, 0.8)"
                    v-else
                  >
                    <div v-for="(o,i) in presetName" :key="i">
                      <el-button
                        @click="open(o)"
                        type="text"
                        style="padding: 0"
                        title="点击跳转到改设备"
                      >
                        <div v-cloak>
                          <i
                            class="el-icon-warning-outline"
                            style="color: red"
                          ></i>
                          <span
                            style="
                              width: 130px;
                              display: inline-block;
                              text-align: left;
                            "
                            >{{o.name}}</span
                          >
                          <span
                            style="
                              width: 130px;
                              display: inline-block;
                              text-align: left;
                            "
                            >{{o.desc}}</span
                          >
                          <span
                            style="
                              width: 130px;
                              display: inline-block;
                              text-align: left;
                            "
                            >{{o.time}}</span
                          >
                        </div></el-button
                      >
                    </div>
                  </el-card>
                </div>
              </div>
              <div style="width: 100%; display: flex; height: 195px">
                <div style="width: 50%; border-right: 1px solid #00b1df">
                  <div id="echarts"></div>
                </div>
                <div style="width: 50%">
                  <div id="echart"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script src="./js/vue.js"></script>
  <script src="./js/jquery.min.js"></script>
  <script src="./js/jquery-1.11.1.js"></script>
  <script src="./js/index.js"></script>
  <script src="./js/video.js"></script>
  <script src="./js/EZUIKit-JavaScript/ezuikit.js"></script>
  <script src="./js/echarts.min.js"></script>
  <script src="./js/jquery-1.12.4.min.js"></script>
  <script src="./js/jsencrypt.min.js"></script>
  <script src="./js/jsWebControl-1.0.0.min.js"></script>
  <script
    type="text/javascript"
    src="https://webapi.amap.com/maps?v=1.4.15&key=0c3cef4b333aa2918685e4a0d4559f68&plugin=AMap.ToolBar,AMap.Marker,AMap.Driving,AMap.DistrictSearch,AMap.Autocomplete,AMap.PlaceSearch,AMap.Geolocation,AMap.Geocoder,AMap.MapType"
  ></script>
  <script>
    let electron = require("electron");
    const { ipcRenderer } = electron;
    var app = new Vue({
      el: "#app",
      data: {
        data: [],
        deviceName: [],
        departTreeList: [],
        defaultProps: {
          children: "child",
          label: "name",
        },
        imagelist: [],
        imageurl: "http://www.cqset.com:3000/",
        presetName: [],
        src: "",
        loading: true,
        indexlist: [],
        image: true,
        getDepartid: "",
        titleShow: "",
        centerZ: [],
      },
      created() {
        this.getDepartID();
      },
      mounted() {
        this.getdepart();
        this.getbar();
        this.getimage();
      },
      methods: {
        //在localStorage里去取出登陆成功返回的部门ID
        getDepartID() {
          this.getDepartid = "";
          this.centerZ = [];
          let id = JSON.parse(localStorage.getItem("LoginUser"));
          this.getDepartid = id.departID;
          let arr = this.getDepartid.split("/");
          var tmp = this.getDepartid;
          switch (tmp) {
            case "1/29/":
              this.titleShow = "薛家湾供电局";
              this.centerZ = [111.236606, 39.864931];
              break;
            case "1/222/":
              this.titleShow = "故障定位";
              this.centerZ = [106.550464, 29.563761];
              break;
            case "1/":
              this.titleShow = "南电科技智慧输电管理平台";
              this.centerZ = [106.550464, 29.563761];
              break;
            case "1/24/":
              this.titleShow = "鄂尔多斯智慧输电管理系统";
              this.centerZ = [109.452535, 39.929747];
              break;
            case "1/24/236/":
              this.titleShow = "鄂尔多斯智慧输电一处管理系统";
              this.centerZ = [109.452535, 39.929747];
              break;
            case "1/24/237/":
              this.titleShow = "鄂尔多斯智慧输电二处管理系统";
              this.centerZ = [109.452535, 39.929747];
              break;
            case "1/35/":
              this.titleShow = "巴彦淖尔电业局应急管理指挥中心";
              this.centerZ = [107.416959, 40.757402];
              break;
            case "1/223/":
              this.titleShow = "国网西藏电力公司智慧电全景平台";
              this.centerZ = [91.171961, 29.653482];
              break;
            case "1/56/":
              this.titleShow = "巴彦淖尔电业局智慧输电管理系统";
              this.centerZ = [107.416959, 40.757402];
              break;
            case "1/47/":
              this.titleShow = "锡林郭勒电业局输电处";
              this.centerZ = [116.106783, 43.941332];
              break;
            case "1/56/68/":
              this.titleShow = "巴彦淖尔修试管理处";
              this.centerZ = [107.416959, 40.757402];
              break;
          }
        },
        handleNodeClick(datas) {
          let that = this;
          if (datas.node_type == "DEPARTMENT") {
            let data = {
              page: 1,
              size: 100,
              sort: "desc",
              keyword: "",
              dept_id: datas.dept_id,
            };
            $.ajax({
              type: "POST",
              url: "http://www.cqset.com:8081/api/v2/line/list",
              contentType: "application/json; charset=utf-8",
              data: JSON.stringify(data),
              success: function (res) {
                datas.child = res.data;
              },
            });
          }
          if (datas.node_type == "LINE") {
            let data = {
              page: 1,
              size: 100,
              sort: "desc",
              keyword: "",
              line_id: datas.line_id,
            };
            $.ajax({
              type: "POST",
              url: "http://www.cqset.com:8081/api/v2/towers/list",
              contentType: "application/json; charset=utf-8",
              data: JSON.stringify(data),
              success: function (res) {
                datas.child = res.data;
              },
            });
          }
          if (datas.node_type == "TOWER") {
            let data = {
              page: 1,
              size: 100,
              sort: "desc",
              keyword: "",
              tower_id: datas.tower_id,
            };
            $.ajax({
              type: "POST",
              url: "http://www.cqset.com:8081/api/v2/device/list",
              contentType: "application/json; charset=utf-8",
              data: JSON.stringify(data),
              success: function (res) {
                datas.child = res.data;
              },
            });
          }
          if (datas.node_type == "DEVICE") {
          }
        },
        getimage() {
          let that = this;
          let endTime = new Date().getTime();
          let startTime = new Date().getTime() - 80000000;
          that.getajax(
            "http://www.cqset.com:3100/api/v1/device/device_submit",
            {
              departID: this.getDepartid,
              headID: "18",
              footerID: "5",
              page: 0,
              pageSize: 10,
              type: 1,
              startTime: startTime,
              endTime: endTime,
            },
            function (res) {
              res.data.list.forEach((item) => {
                that.indexlist.push(item);
                that.presetName.push(item);
              });
              that.loading = false;
              // getmap();
            }
          );
        },
        quit() {
          ipcRenderer.send("destroy");
        },
        getajax(url, data, callback) {
          $.ajax({
            type: "POST",
            url: url,
            data: data,
            success: function (res) {
              callback(res);
            },
            dataType: "json",
          });
        },
        open(val) {
          ipcRenderer.send("openvideos", val);
        },
        control() {
          localStorage.setItem("num", 1);
          ipcRenderer.send("opencontrol");
        },
        temperature() {
          ipcRenderer.send("opentemperature");
        },
        tower() {
          ipcRenderer.send("opentower");
        },
        displacement() {
          ipcRenderer.send("opendisplacement");
        },
        screw() {
          ipcRenderer.send("openscrew");
        },
        bird() {
          ipcRenderer.send("openbird");
        },
        ai() {
          ipcRenderer.send("openai");
        },
        uva() {
          ipcRenderer.send("openuva");
        },
        location() {
          ipcRenderer.send("openlocation");
        },
        safe() {
          ipcRenderer.send("opensafe");
        },
        getbar() {
          let data = {
            depart_id: this.getDepartid,
          };
          $.ajax({
            type: "POST",
            url: "http://www.cqset.com:8081/api/v2/device/statistics_online",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(data),
            success: function (res) {
              console.log(res);
              let num1 = [];
              let online = [];
              let xdata = [
                "驱鸟系统",
                "GNSS",
                "视频监控",
                "布控装置",
                "测温装置",
                "杆塔监测",
                "螺丝松动",
                "故障定位",
                "隧道监控",
              ];
              res.data.forEach((item, index) => {
                xdata.forEach((e, i) => {
                  if (item.name == e) {
                    xdata.splice(i, 1);
                    xdata.splice(index, 0, e);
                  }
                });
                let obj1 = {};
                obj1.value = item.num;
                obj1.name = item.name;
                num1.push(obj1);
                let obj2 = {};
                obj2.value = item.online;
                obj2.name = item.name;
                online.push(obj2);
              });
              var myCharts1 = echarts.init(document.getElementById("echarts"));
              var option = {
                title: {
                  top: 10,
                  text: "设备在线图",
                  x: "center",
                  textStyle: {
                    color: "#00b1df",
                    fontSize: 23,
                  },
                },
                legend: {
                  right: "30",
                  top: "10",
                  textStyle: {
                    color: "#fff",
                    fontSize: 12,
                  },
                },
                tooltip: {
                  trigger: "axis",
                  axisPointer: {
                    type: "shadow",
                  },
                },
                grid: {
                  left: "0",
                  right: "0",
                  bottom: "1%",
                  containLabel: true,
                },
                xAxis: {
                  type: "category",
                  data: xdata,
                  axisLabel: {
                    textStyle: {
                      color: "#fff",
                      fontSize: 10,
                    },
                  },
                },
                yAxis: {
                  type: "value",
                  show: false,
                  splitLine: {
                    show: false,
                  },
                },
                series: [
                  {
                    data: num1,
                    type: "bar",
                    name: "总台数",
                    barWidth: 25,
                    barGap: 0,
                    itemStyle: {
                      normal: {
                        color: ["#00eacb"],
                      },
                    },
                    label: {
                      show: true,
                      position: "top",
                      formatter: "{c}台",
                      textStyle: {
                        color: "#fff",
                        fontSize: 8,
                      },
                    },
                  },
                  {
                    data: online,
                    type: "bar",
                    name: "在线台数",
                    barWidth: 25,
                    itemStyle: {
                      normal: {
                        color: ["#1c68da"],
                      },
                    },
                    label: {
                      show: true,
                      position: "top",
                      formatter: "{c}台",
                      textStyle: {
                        color: "#fff",
                        fontSize: 8,
                      },
                    },
                  },
                ],
              };
              myCharts1.setOption(option);

              var myCharts2 = echarts.init(document.getElementById("echartss"));
              var optionss = {
                title: {
                  text: "设备统计图",
                  top: 15,
                  x: "center",
                  textStyle: {
                    color: "#00b1df",
                    fontSize: 23,
                  },
                },
                color: [
                  "#ff8955",
                  "#ffd200",
                  "#00eacb",
                  "#00b4ff",
                  "#1c68da",
                  "#954eff",
                  "#ff5454",
                  "#303133",
                  "#f56c6c",
                  "#5c887a",
                ],
                tooltip: {
                  trigger: "item",
                },
                legend: {
                  bottom: "0",
                  left: "center",
                  textStyle: {
                    color: "#fff",
                    fontSize: 12,
                  },
                },
                series: [
                  {
                    name: "设备比例",
                    type: "pie",
                    radius: ["40%", "65%"],
                    label: {
                      show: false,
                      position: "center",
                    },
                    itemStyle: {
                      normal: {
                        label: {
                          show: true,
                          position: "inner",
                          textStyle: {
                            fontWeight: 300,
                            fontSize: 14,
                            color: "#fff",
                          },
                          formatter: "{d}%",
                        },

                        labelLine: {
                          show: false,
                        },
                      },
                    },

                    emphasis: {
                      label: {
                        show: true,
                        fontSize: "20",
                        fontWeight: "bold",
                        color: "#fff",
                      },
                    },
                    labelLine: {
                      show: false,
                    },

                    data: num1,
                  },
                ],
              };
              myCharts2.setOption(optionss);
            },
          });
          $.ajax({
            type: "POST",
            url: "http://www.cqset.com:8081/api/v2/device/statistics_warning",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(data),
            success: function (res) {
              let xdata = [
                "视频监控",
                "GNSS",
                "布控装置",
                "测温装置",
                "驱鸟系统",
                "杆塔监测",
                "螺丝松动",
                "故障定位",
                "隧道监控",
              ];
              let num = [];
              let online = [];
              res.data.forEach((item, index) => {
                xdata.forEach((e, i) => {
                  if (e == item.name) {
                    xdata.splice(i, 1);
                    xdata.splice(index, 0, e);
                  }
                });
                num.push(item.warning_num);
                online.push(item.clear_num);
              });
              var myCharts = echarts.init(document.getElementById("echart"));
              var options = {
                title: {
                  text: "告警统计图",
                  top: 10,
                  x: "center",
                  textStyle: {
                    color: "#00b1df",
                    fontSize: 23,
                  },
                },
                legend: {
                  right: "30",
                  top: "10",
                  textStyle: {
                    color: "#fff",
                    fontSize: 12,
                  },
                },
                tooltip: {
                  trigger: "axis",
                  axisPointer: {
                    type: "shadow",
                  },
                },
                grid: {
                  left: "0",
                  right: "0",
                  bottom: "1%",
                  containLabel: true,
                },
                xAxis: {
                  type: "category",
                  data: xdata,
                  axisLabel: {
                    textStyle: {
                      color: "#fff",
                      fontSize: 10,
                    },
                  },
                },
                yAxis: {
                  type: "value",
                  show: false,
                  splitLine: {
                    show: false,
                  },
                },
                series: [
                  {
                    data: num,
                    type: "bar",
                    name: "告警条数",
                    barWidth: 20,
                    barGap: 0,
                    itemStyle: {
                      normal: {
                        color: ["#00b4ff"],
                      },
                    },
                    label: {
                      show: true,
                      position: "top",
                      formatter: "{c}条",
                      textStyle: {
                        color: "#fff",
                        fontSize: 10,
                      },
                    },
                  },
                  {
                    data: online,
                    type: "bar",
                    barWidth: 20,
                    name: "消缺次数",
                    itemStyle: {
                      normal: {
                        color: ["#ff5454"],
                      },
                    },
                    label: {
                      show: true,
                      position: "top",
                      formatter: "{c}次",
                      textStyle: {
                        color: "#fff",
                        fontSize: 10,
                      },
                    },
                  },
                ],
              };
              myCharts.setOption(options);
            },
          });
        },
        getdata() {
          ipcRenderer.on("data", (e, val) => {
            this.departID = val.departID;
            let that = this;
            that.getajax(
              "http://www.cqset.com:3100/api/v1/pc/devicelist",
              {
                departID: that.departID,
              },
              function (res) {
                that.deviceName = res.data.list;
              }
            );
          });
        },
        full() {
          localStorage.setItem("num", 0);
          ipcRenderer.send("openhome");
        },
        journal() {
          ipcRenderer.send("openjournal");
        },
        getdepart() {
          let that = this;
          let d = that.getDepartid.split("/");
          d = d[d.length - 2];
          let data = { pid: +d };
          $.ajax({
            type: "POST",
            url: "http://www.cqset.com:8081/api/v2/dept/tree",
            contentType: "application/json; ",
            data: JSON.stringify(data),
            success: function (res) {
              let data = [];
              data.push(res.data);
              that.departTreeList = data;
            },
          });
        },
      },
    });
    getMap();
    function getMap() {
      var map = new AMap.Map("earth", {
        resizeEnable: false,
        zoom: 10,
        center: app.centerZ,
        viewMode: "2D",
      });
      map.addControl(
        new AMap.MapType({
          defaultType: 0,
        })
      );
      let markers = [];
      main();
      function getAllMarkers(data) {
        return new Promise((reslove, reject) => {
          $.ajax({
            type: "POST",
            url: "http://www.cqset.com:8081/api/v2/line/list",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(data),
            success: function (res) {
              reslove(res);
            },
          });
        });
      }
      function getWarning(data) {
        return new Promise((reslove, reject) => {
          $.ajax({
            type: "POST",
            url: "http://www.cqset.com:3100/api/v1/device/device_submit",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(data),
            success: function (res) {
              reslove(res);
            },
          });
        });
      }
      async function main() {
        let endTime = new Date().getTime();
        let startTime = new Date().getTime() - 80000000;
        let id = JSON.parse(localStorage.getItem("LoginUser"));
        let d = id.departID.substr(2, 2);
        let D = +d;
        let data1 = {
          page: 1,
          size: 20,
          sort: "desc",
          keyword: "",
          dept_id: D,
        };
        let data2 = {
          departID: id.departID,
          headID: "18",
          footerID: "5",
          page: 0,
          pageSize: 10,
          type: 1,
          startTime: startTime,
          endTime: endTime,
        };
        let result1 = await getAllMarkers(data1);
        let result2 = await getWarning(data2);
        let mark1 = [];
        let mark2 = [];
        result1.data.forEach((item) => {
          item.child.forEach((items) => {
            mark1.push(items);
          });
        });
        result2.data.list.forEach((item, index) => {
          mark2.push(item);
        });
        addMarker1();
        addMarker2();
        function addMarker1() {
          let mar = [];
          mark1.forEach((item, index) => {
            var marker = new AMap.Marker({
              map: map,
              position: [item.lon - 0, item.lat - 0],
              resizeEnable: true,
              offset: new AMap.Pixel(-10, -30),
              icon: new AMap.Icon({
                size: new AMap.Size(35, 40),
                image: "./img/铁塔2绿.png",
                imageOffset: new AMap.Pixel(-4, 1),
              }),
            });
            marker.setLabel({
              offset: new AMap.Pixel(-13, -17),
              content: item.name,
              direction: "right",
            });
            mar.push(marker);
          });
          map.add(mar);
        }
        function addMarker2() {
          let mar = [];
          mark2.forEach((item, index) => {
            item.location = item.location.split(",");
            var marker = new AMap.Marker({
              map: map,
              position: [item.location[0], item.location[1]],
              resizeEnable: true,
              offset: new AMap.Pixel(-10, -30),
              icon: new AMap.Icon({
                size: new AMap.Size(35, 40),
                image: "./img/铁塔2.png",
                imageOffset: new AMap.Pixel(-4, 1),
              }),
              extData: {
                cameraIndexCode: item.cameraIndexCode,
                cameraName: item.cameraName,
              },
            });
            marker.setLabel({
              offset: new AMap.Pixel(-13, -17),
              content: item.cameraName,
              direction: "right",
            });
            marker.on("click", doMaker);
            mar.push(marker);
          });
          map.add(mar);
          function doMaker(e) {
            let text = e.target.w.extData;
            mark2.forEach((item) => {
              if (item.deviceSerial == text.cameraIndexCode) {
                let val = {};
                val.deviceSerial = item.deviceSerial;
                val.deviceName = item.cameraName;
                ipcRenderer.send("openvideos", val);
              }
            });
          }
        }
        addMarker3();
        function addMarker3() {
          mark2.forEach((item) => {
            var circleMarker = new AMap.CircleMarker({
              center: [item.location[0], item.location[1]],
              radius: 10 + Math.random() * 10,
              strokeColor: "white",
              strokeWeight: 2,
              strokeOpacity: 0.5,
              fillColor: "rgba(245,108,108,0.9)",
              fillOpacity: 0.5,
              zIndex: 10,
              bubble: true,
              cursor: "pointer",
              clickable: true,
            });
            circleMarker.setMap(map);
          });
        }
      }
    }
  </script>
</html>
